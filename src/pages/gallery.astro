---
import PageLayout from '../layouts/PageLayout.astro';
import fs from 'node:fs';
import path from 'node:path';

// Read all work2025 images at build time
const work2025Dir = path.join(process.cwd(), 'public/images/gallery/work2025');
let work2025Images: string[] = [];
try {
  work2025Images = fs.readdirSync(work2025Dir)
    .filter((f: string) => f.endsWith('.jpg'))
    .sort()
    .map((f: string) => `/images/gallery/work2025/${f}`);
} catch (e) {
  // Directory may not exist
}
---

<PageLayout
  title="Our Work â€” Garden Photos & Projects | Gardening Services Dundalk"
  description="Browse our portfolio of 500+ completed gardening and landscaping projects across Dundalk and County Louth. Before and after photos."
>
  <section class="section section-green">
    <div class="container">
      <div class="section-header">
        <span class="section-badge">ðŸ“¸ Our Work</span>
        <h1>Project Gallery</h1>
        <p class="section-subtitle">Hundreds of completed projects across Dundalk and County Louth.</p>
        <hr class="section-divider" />
      </div>
    </div>
  </section>

  <section class="section section-white">
    <div class="container">
      <h2 class="text-center" style="margin-bottom: 0.5rem;">Before & After</h2>
      <p class="text-center section-subtitle" style="margin-bottom: 2rem;">Drag the slider to see the transformation.</p>

      <div class="ba-gallery fade-in">
        <div class="ba-slider" tabindex="0" role="slider" aria-label="Before and after comparison" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50">
          <img src="/images/before-after/after-1.jpg" alt="After garden transformation" loading="lazy" />
          <div class="ba-before"><img src="/images/before-after/before-1.jpg" alt="Before garden transformation" loading="lazy" /></div>
          <div class="ba-divider"></div>
          <div class="ba-handle"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/><polyline points="9 18 15 12 9 6" transform="translate(6,0)"/></svg></div>
          <span class="ba-label ba-label-before">Before</span>
          <span class="ba-label ba-label-after">After</span>
        </div>
      </div>
    </div>
  </section>

  <section class="section section-green">
    <div class="container">
      <h2 class="text-center" style="margin-bottom: 0.5rem;">Recent Projects</h2>
      <p class="text-center section-subtitle" style="margin-bottom: 2rem;">{work2025Images.length}+ photos from our 2025 projects across County Louth.</p>
      <div class="gallery-grid">
        {work2025Images.map((src, i) => (
          <div class="gallery-item fade-in">
            <img src={src} alt={`Gardening project ${i + 1} â€” Pete & Seamus, County Louth`} loading="lazy" width="400" height="300" />
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="cta-section">
    <div class="container fade-in">
      <h2>Like What You See?</h2>
      <p>Get in touch for a free quote on your garden project.</p>
      <a href="tel:+353851685170" class="cta-phone">085 168 5170</a>
      <div class="cta-buttons">
        <a href="tel:+353851685170" class="btn btn-cta btn-lg">Call Now</a>
        <a href="https://wa.me/353851685170?text=Hi%2C%20I%27d%20like%20a%20quote%20for%20gardening%20services" class="btn btn-whatsapp btn-lg" target="_blank" rel="noopener">WhatsApp Us</a>
        <a href="/contact/" class="btn btn-white btn-lg">Get a Free Quote</a>
      </div>
    </div>
  </section>

  <script>
    function initSliders() {
      document.querySelectorAll('.ba-slider').forEach((slider) => {
        const before = slider.querySelector('.ba-before') as HTMLElement;
        const divider = slider.querySelector('.ba-divider') as HTMLElement;
        const handle = slider.querySelector('.ba-handle') as HTMLElement;
        if (!before || !divider || !handle) return;
        let isDragging = false;
        function updatePosition(x: number) {
          const rect = slider.getBoundingClientRect();
          let percent = ((x - rect.left) / rect.width) * 100;
          percent = Math.max(0, Math.min(100, percent));
          before.style.width = percent + '%';
          divider.style.left = percent + '%';
          handle.style.left = percent + '%';
          before.querySelector('img')!.style.width = rect.width + 'px';
          slider.setAttribute('aria-valuenow', String(Math.round(percent)));
        }
        slider.addEventListener('mousedown', (e: Event) => { isDragging = true; updatePosition((e as MouseEvent).clientX); e.preventDefault(); });
        document.addEventListener('mousemove', (e) => { if (isDragging) updatePosition(e.clientX); });
        document.addEventListener('mouseup', () => { isDragging = false; });
        slider.addEventListener('touchstart', (e: Event) => { isDragging = true; updatePosition((e as TouchEvent).touches[0].clientX); }, { passive: true });
        document.addEventListener('touchmove', (e) => { if (isDragging) updatePosition(e.touches[0].clientX); }, { passive: true });
        document.addEventListener('touchend', () => { isDragging = false; });
        slider.addEventListener('keydown', (e: Event) => {
          const ke = e as KeyboardEvent;
          const current = parseFloat(before.style.width) || 50;
          const rect = slider.getBoundingClientRect();
          if (ke.key === 'ArrowLeft') updatePosition(rect.left + ((current - 2) / 100) * rect.width);
          else if (ke.key === 'ArrowRight') updatePosition(rect.left + ((current + 2) / 100) * rect.width);
        });
        const rect = slider.getBoundingClientRect();
        const beforeImg = before.querySelector('img') as HTMLElement;
        if (beforeImg && rect.width > 0) beforeImg.style.width = rect.width + 'px';
        window.addEventListener('resize', () => {
          const r = slider.getBoundingClientRect();
          const bi = before.querySelector('img') as HTMLElement;
          if (bi && r.width > 0) bi.style.width = r.width + 'px';
        });
      });
    }
    initSliders();
    document.addEventListener('astro:after-swap', initSliders);
  </script>
</PageLayout>
